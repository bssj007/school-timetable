# ğŸ’¬ ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼ ì„¤ì • ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”
ìˆ˜í–‰í‰ê°€ í•˜ë£¨ ì „ ìë™ìœ¼ë¡œ ì¹´ì¹´ì˜¤í†¡ ë©”ì‹œì§€ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
- **ì•Œë¦¼ ì‹œê°„**: ë§¤ì¼ ì˜¤ì „ 9ì‹œ
- **ì•Œë¦¼ ì¡°ê±´**: ë‚´ì¼ ìˆ˜í–‰í‰ê°€ê°€ ìˆëŠ” ê²½ìš°

---

## ğŸ”§ Kakao Developers ì„¤ì • (ê´€ë¦¬ììš©)

### 1. ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •
```
https://developers.kakao.com/console ì ‘ì†

1. ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ > school-timetable ì„ íƒ
2. í”Œë«í¼ ì„¤ì • > Web í”Œë«í¼ ì¶”ê°€
   - ì‚¬ì´íŠ¸ ë„ë©”ì¸: https://school-timetable.pages.dev

3. Redirect URI ì„¤ì •:
   https://school-timetable.pages.dev/api/kakao/callback

4. ë™ì˜í•­ëª© ì„¤ì •:
   - ì¹´ì¹´ì˜¤í†¡ ë©”ì‹œì§€ ì „ì†¡: í•„ìˆ˜ ë™ì˜
   - ì¹œêµ¬ ëª©ë¡ ì¡°íšŒ: ì„ íƒ ë™ì˜

5. ë¹„ì¦ˆë‹ˆìŠ¤ ì„¤ì • > ë©”ì‹œì§€ í…œí”Œë¦¿ ë“±ë¡ (ì„ íƒ)
```

### 2. REST API í‚¤ í™•ì¸
```
í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ í‚¤: bad8ca2530fb7a47eaf2e14ba1d2bb94
ìœ„ì¹˜: functions/api/kakao/[[path]].ts
```

---

## ğŸ‘¤ ì‚¬ìš©ì ê°€ì´ë“œ

### 1. ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸
```
1. ì‚¬ì´íŠ¸ ì ‘ì†: https://school-timetable.pages.dev
2. ìš°ì¸¡ ìƒë‹¨ "ì¹´ì¹´ì˜¤ ì•Œë¦¼ ì—°ë™" ë²„íŠ¼ í´ë¦­
3. ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í›„ ë™ì˜
4. ìë™ìœ¼ë¡œ ì‚¬ì´íŠ¸ë¡œ ëŒì•„ì˜´
```

### 2. ìˆ˜í–‰í‰ê°€ ë“±ë¡
```
1. ì‹œê°„í‘œì—ì„œ ê³¼ëª© í´ë¦­
2. ìˆ˜í–‰í‰ê°€ ì •ë³´ ì…ë ¥
3. ì €ì¥
```

### 3. ì•Œë¦¼ ë°›ê¸°
```
- ë§¤ì¼ ì˜¤ì „ 9ì‹œ ìë™ ì²´í¬
- ë‚´ì¼ ìˆ˜í–‰í‰ê°€ê°€ ìˆìœ¼ë©´ ì¹´ì¹´ì˜¤í†¡ ë©”ì‹œì§€ ì „ì†¡
```

---

## ğŸ“± ì•Œë¦¼ ë©”ì‹œì§€ ì˜ˆì‹œ

```
ğŸ“ ë‚´ì¼ ìˆ˜í–‰í‰ê°€ ì•Œë¦¼!

ê³¼ëª©: êµ­ì–´
ë‚´ìš©: ì‹œ ì•”ì†¡í•˜ê¸°
ë‚ ì§œ: 2024-12-22
êµì‹œ: 3êµì‹œ

ì—´ì‹¬íˆ ì¤€ë¹„í•˜ì„¸ìš”! í™”ì´íŒ… ğŸ’ª

[ë°”ë¡œê°€ê¸°: í•™êµ ì‹œê°„í‘œ ìœ„í‚¤]
```

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì•Œë¦¼ì´ ì•ˆ ì™€ìš”
1. **ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í™•ì¸**
   - "ì¹´ì¹´ì˜¤ ì•Œë¦¼ ì—°ë™" ë²„íŠ¼ ë‹¤ì‹œ í´ë¦­
   - ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸

2. **ìˆ˜í–‰í‰ê°€ ë‚ ì§œ í™•ì¸**
   - ì•Œë¦¼ì€ í•˜ë£¨ ì „ì—ë§Œ ë°œì†¡
   - ë‚´ì¼ ë‚ ì§œì¸ì§€ í™•ì¸

3. **DB í™•ì¸ (ê´€ë¦¬ì)**
   ```sql
   SELECT * FROM users WHERE notificationEnabled = 1;
   ```

### í† í° ë§Œë£Œ ì‹œ
```
- ì¹´ì¹´ì˜¤ access tokenì€ 6ì‹œê°„ ìœ íš¨
- refresh tokenìœ¼ë¡œ ìë™ ê°±ì‹  í•„ìš”
- í˜„ì¬ëŠ” ìˆ˜ë™ ì¬ë¡œê·¸ì¸ í•„ìš”
```

---

## ğŸš€ ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Cloudflare D1 ë§ˆì´ê·¸ë ˆì´ì…˜
```sql
-- 1. users í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  kakaoId TEXT UNIQUE NOT NULL,
  kakaoAccessToken TEXT,
  kakaoRefreshToken TEXT,
  nickname TEXT,
  grade INTEGER NOT NULL,
  classNum INTEGER NOT NULL,
  notificationEnabled INTEGER DEFAULT 1,
  createdAt TEXT DEFAULT (datetime('now')),
  updatedAt TEXT DEFAULT (datetime('now'))
);

-- 2. performance_assessmentsì— userId ì¶”ê°€
ALTER TABLE performance_assessments ADD COLUMN userId INTEGER;
```

### Cloudflare Pages Cron í™œì„±í™”

âš ï¸ **ì¤‘ìš”**: Cloudflare PagesëŠ” wrangler.tomlì—ì„œ cron ì„¤ì •ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ëŒ€ì‹  ì§ì ‘ Dashboardì—ì„œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤:

```
1. Cloudflare Dashboard ì ‘ì†
   https://dash.cloudflare.com

2. Workers & Pages > school-timetable ì„ íƒ

3. Settings > Functions > Cron Triggers íƒ­

4. Add Cron Trigger í´ë¦­
   - Cron expression: 0 0 * * *
   - ì„¤ëª…: Daily assessment reminder at 9 AM KST
   
5. ì €ì¥

ì°¸ê³ : UTC 0ì‹œ = KST 9ì‹œ
```

ë˜ëŠ” í˜„ì¬ëŠ” **Cloudflare Pagesì—ì„œ scheduled handlers (_scheduled.ts)ë¥¼ ì™„ì „íˆ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.
ëŒ€ì•ˆ:
- External cron service (cron-job.org, EasyCron ë“±) ì‚¬ìš©
- Cloudflare Workerë¡œ ë³„ë„ ë°°í¬
```

---

## ğŸ“Š ì‹œìŠ¤í…œ íë¦„ë„

```
[ì‚¬ìš©ì]
   â†“
[ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸] â†’ OAuth ì¸ì¦
   â†“
[í† í° ì €ì¥] â†’ D1 Database (users í…Œì´ë¸”)
   â†“
[ìˆ˜í–‰í‰ê°€ ë“±ë¡] â†’ performance_assessments í…Œì´ë¸” (userId í¬í•¨)
   â†“
[ë§¤ì¼ ì˜¤ì „ 9ì‹œ] â†’ Cloudflare Cron Trigger
   â†“
[ë‚´ì¼ ìˆ˜í–‰í‰ê°€ ì¡°íšŒ] â†’ SQL Query
   â†“
[ì¹´ì¹´ì˜¤ ë©”ì‹œì§€ ì „ì†¡] â†’ Kakao API
   â†“
[ì‚¬ìš©ì ì¹´ì¹´ì˜¤í†¡ ìˆ˜ì‹ ] ğŸ’¬
```

---

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **í† í° ì €ì¥**
   - Access tokenì€ DBì— ì•”í˜¸í™” ì—†ì´   ì €ì¥ (ì£¼ì˜!)
   - í”„ë¡œë•ì…˜ì—ì„œëŠ” ì•”í˜¸í™” ê¶Œì¥

2. **ê¶Œí•œ ê´€ë¦¬**
   - ì‚¬ìš©ìëŠ” ìì‹ ì˜ ìˆ˜í–‰í‰ê°€ë§Œ ì¡°íšŒ
   - userIdë¡œ ë°ì´í„° ê²©ë¦¬

3. **í† í° ê°±ì‹ **
   - Refresh token í™œìš© í•„ìš”
   - ë§Œë£Œ ì‹œ ìë™ ì¬ë°œê¸‰ ë¡œì§ ì¶”ê°€ ì˜ˆì •

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Kakao Developers ë¬¸ì„œ](https://developers.kakao.com/docs)
- [Kakao ë©”ì‹œì§€ API](https://developers.kakao.com/docs/latest/ko/message/rest-api)
- [Cloudflare Workers Cron](https://developers.cloudflare.com/workers/configuration/cron-triggers/)
- [Cloudflare D1](https://developers.cloudflare.com/d1/)
